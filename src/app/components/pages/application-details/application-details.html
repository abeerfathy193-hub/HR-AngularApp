<div class="page-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Loading application details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-state card">
    <div class="error-icon">⚠️</div>
    <h3>Error Loading Application</h3>
    <p>{{ error }}</p>
    <button class="btn btn-outline" (click)="loadApplication()">
      Try Again
    </button>
  </div>

  <!-- Success Message -->
  <div *ngIf="success" class="success-message card">
    <div class="success-icon">✅</div>
    <p>{{ success }}</p>
  </div>

  <!-- Application Details -->
  <div *ngIf="application && !isLoading" class="application-details">
    <div class="page-header">
      <div>
        <h2>Application Details</h2>
        <div class="text-muted">
          Applied on {{ getFormattedDate(application.appliedAt) }}
          • ID: {{ application.id }}
        </div>
      </div>
      <!-- <div class="header-actions">
        <button class="btn btn-outline" (click)="onAddInterview()">
          <i class="fas fa-calendar-plus"></i> Add Interview
        </button>
      </div> -->
    </div>

    <div class="card">
      <div class="card-body">
        <div class="application-info">
          <!-- Applicant Information -->
          <div class="info-section">
            <h3 class="card-title">Applicant Information</h3>
            <div class="form-row">
              <div class="form-group">
                <label>Applicant ID</label>
                <div class="readonly-field">{{ application.applicantId || 'Not specified' }}</div>
              </div>
              <div class="form-group">
                <label>Full Name</label>
                <div class="readonly-field">{{ application.fullName || 'Not available' }}</div>
              </div>
              <div class="form-group">
                <label>Gender</label>
                <!-- <div class="readonly-field"  [ngClass]="getGenderText(application.gender)">{{ getGenderText( application.gender) }}</div> -->
                <span [ngClass]="getGenderText(application.gender)">
                  {{ getGenderText(application.gender) }}
                </span>

              </div>
            </div>
          </div>

          <!-- Application Details -->
          <div class="info-section">
            <h3 class="card-title">Application Details</h3>
            <div class="form-row">
              <div class="form-group">
                <label>Vacancy ID</label>
                <div class="readonly-field">{{ application.vacancyId }}</div>
              </div>
              <div class="form-group">
                <label>Applied At</label>
                <div class="readonly-field">{{ getFormattedDate(application.appliedAt) }}</div>
              </div>
              <div class="form-group">
                <label>Source</label>
                <div class="readonly-field">{{ getApplicationSourceDisplay(application.applicationSource) }}</div>
              </div>
            </div>
          </div>

          <!-- Status Section (Editable) -->
          <div class="info-section">
            <h3 class="card-title">Application Status</h3>
            <div class="form-row align-items-center">
              <div class="form-group">
                <label>Status</label>
                <div class="status-control-group">
                  <select 
                    [formControl]="statusControl" 
                    class="form-select"
                    [class.loading]="isSaving"
                  >
                    <option value="">Select Status</option>
                    <option *ngFor="let status of statusOptions" [value]="status">
                      {{ status }}
                    </option>
                  </select>
                  <button 
                    class="btn btn-primary save-status-btn" 
                    (click)="onStatusChange()"
                    [disabled]="!statusControl.value || statusControl.value === currentStatus || isSaving"
                  >
                    <span *ngIf="!isSaving">Save Status</span>
                    <span *ngIf="isSaving">Saving...</span>
                  </button>
                </div>
              </div>
              <div class="form-group">
                <label>Reviewed At</label>
                <div class="readonly-field">{{ getFormattedDate(application.reviewedAt) }}</div>
              </div>
            </div>
          </div>

          <!-- Additional Information -->
          <div class="info-section">
            <h3 class="card-title">Additional Information</h3>
            <div class="form-row">
              <div class="form-group">
                <label>Expected Salary</label>
                <div class="readonly-field">
                  {{ application.expectedSalary ? getCurrencySymbol(application.salaryCurrency) + application.expectedSalary : 'Not specified' }}
                </div>
              </div>
              <div class="form-group">
                <label>Years of Experience</label>
                <div class="readonly-field">{{ application.yearsOfExperience || 'Not specified' }}</div>
              </div>
              <div class="form-group">
                <label>Available From</label>
                <div class="readonly-field">{{ getFormattedDate(application.availableFrom) }}</div>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label>Notice Period</label>
                <div class="readonly-field">{{ application.noticePeriod || 'Not specified' }}</div>
              </div>
              <div class="form-group">
                <label>Open to Relocation</label>
                <div class="readonly-field">{{ application.isOpenToRelocation ? 'Yes' : 'No' }}</div>
              </div>
              <div class="form-group">
                <label>Preferred Locations</label>
                <div class="readonly-field">{{ application.preferredLocations || 'Not specified' }}</div>
              </div>
            </div>

            <!-- Additional fields from ApplicationDetailsDTO -->
            <div class="form-row" *ngIf="application.maritalStatus || application.militaryStatus">
              <div class="form-group" *ngIf="application.maritalStatus">
                <label>Marital Status</label>
                <div class="readonly-field">{{ application.maritalStatus || 'Not specified' }}</div>
              </div>
              <div class="form-group" *ngIf="application.militaryStatus">
                <label>Military Status</label>
                <div class="readonly-field">{{ application.militaryStatus || 'Not specified' }}</div>
              </div>
            </div>
          </div>

          <!-- Application Rating -->
          <div class="info-section" *ngIf="application.applicationRating">
            <h3 class="card-title">Evaluation</h3>
            <div class="form-row">
              <div class="form-group">
                <label>Application Rating</label>
                <div class="readonly-field">
                  <div class="rating-display">
                    <span class="rating-value">{{ application.applicationRating }}/10</span>
                    <div class="rating-bar">
                      <div class="rating-fill" [style.width.%]="application.applicationRating * 10"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn btn-outline" routerLink="/vacancies">
            <i class="fas fa-arrow-left"></i> Back to Vacancies
          </button>
          <button class="btn btn-primary" (click)="onAddInterview()">
            <i class="fas fa-calendar-plus"></i> Schedule Interview
          </button>
        </div>
      </div>
    </div>
  </div>
</div>