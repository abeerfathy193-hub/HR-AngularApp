<!-- vacancies.component.html -->
<div class="page-container">
  <div class="page-header">
    <h2>Vacancies</h2>
    <div class="text-muted">Manage job vacancies and applications</div>
  </div>

  <!-- Filter Section -->
  <div class="filter-section" [formGroup]="filterForm">
    <div class="filter-header">
      <h3>Filter Vacancies</h3>
      <button class="btn-add-vacancy" (click)="addNewVacancy()">
        <i class="fas fa-plus"></i> Add Vacancy
      </button>
    </div>
    
    <div class="filter-row">
      <!-- Department Filter -->
      <div class="filter-group">
        <label>Department</label>
        <select formControlName="department" class="filter-select">
          <option value="all">All Departments</option>
          <option *ngFor="let dept of departments" [value]="dept.id">
            {{ dept.name }}
          </option>
        </select>
      </div>
      
      <!-- Status Filter -->
      <div class="filter-group">
        <label>Status</label>
        <select formControlName="status" class="filter-select">
          <option *ngFor="let status of statusOptions" [value]="status.id">
            {{ status.name }}
          </option>
        </select>
      </div>
      
      <!-- Position Filter -->
      <div class="filter-group">
        <label>Position</label>
        <select formControlName="position" class="filter-select">
          <option value="all">All Positions</option>
          <option *ngFor="let position of positions" [value]="position.id">
            {{ position.title }}
          </option>
        </select>
      </div>
      
      <!-- Employment Type Filter -->
      <div class="filter-group">
        <label>Employment Type</label>
        <select formControlName="employmentType" class="filter-select">
          <option value="all">All Types</option>
          <option *ngFor="let type of employmentTypes" [value]="type.id">
            {{ type.name }}
          </option>
        </select>
      </div>
      
      <!-- Search Filter -->
      <div class="filter-group">
        <label>Search</label>
        <input 
          type="text" 
          formControlName="search" 
          class="filter-select" 
          placeholder="Search vacancies..."
        />
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">Loading...</div>

  <!-- Vacancies List -->
  <div class="vacancies-container" *ngIf="!isLoading">
    <div class="vacancies-list">
      <h3>Vacancies ({{ filteredVacancies.length }})</h3>
      
      <div *ngFor="let vacancy of filteredVacancies" 
           class="vacancy-card"
           [class.selected]="selectedVacancy?.id === vacancy.id"
           (click)="selectVacancy(vacancy)">
        <h4>{{ vacancy.title }}</h4>
        <div class="vacancy-department">{{ vacancy.departmentName }}</div>
        <span class="vacancy-status" [ngClass]="getStatusClass(vacancy.status)">
          {{ vacancy.status }}
        </span>
      </div>
    </div>

    <!-- Vacancy Details Card -->
    <div class="vacancy-details" *ngIf="selectedVacancy">
      <div class="vacancy-details-card">
        <div class="details-header">
          <div class="details-title">
            <h2>{{ selectedVacancy.title }}</h2>
            <div class="vacancy-department">{{ selectedVacancy.departmentName }}</div>
          </div>
          <div class="details-actions">
            <button class="btn-edit" (click)="editVacancy()">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="btn-delete" (click)="confirmDeleteVacancy()">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
        
        <div class="details-info">
          <div class="info-row">
            <div class="info-label">Description:</div>
            <div class="info-value">{{ selectedVacancy.description }}</div>
          </div>
          
          <div class="info-row">
            <div class="info-label">Employment Type:</div>
            <div class="info-value">{{ selectedVacancy.employmentType }}</div>
          </div>
          
          <div class="info-row">
            <div class="info-label">Experience Level:</div>
            <div class="info-value">{{ selectedVacancy.experienceLevel || 'Not specified' }}</div>
          </div>
          
          <div class="info-row">
            <div class="info-label">Salary Range:</div>
            <div class="info-value">{{ getVacancySalaryRange(selectedVacancy) }}</div>
          </div>
          
          <div class="info-row">
            <div class="info-label">Location:</div>
            <div class="info-value">
              {{ selectedVacancy.location || 'Not specified' }}
              <span *ngIf="selectedVacancy.isRemote" class="remote-badge">Remote</span>
            </div>
          </div>
          
          <div class="info-row">
            <div class="info-label">Openings:</div>
            <div class="info-value">{{ selectedVacancy.numberOfOpenings }} position(s)</div>
          </div>
          
          <div class="info-row">
            <div class="info-label">Status:</div>
            <div class="info-value">
              <span [ngClass]="getStatusClass(selectedVacancy.status)">
                {{ selectedVacancy.status }}
              </span>
            </div>
          </div>
          
          <div class="info-row">
            <div class="info-label">Posted Date:</div>
            <div class="info-value">{{ selectedVacancy.postedDate | date:'mediumDate' }}</div>
          </div>
          
          <div class="info-row" *ngIf="selectedVacancy.closingDate">
            <div class="info-label">Closing Date:</div>
            <div class="info-value">
              {{ selectedVacancy.closingDate | date:'mediumDate' }}
              <span *ngIf="getDaysRemaining(selectedVacancy) !== null" 
                    class="days-remaining">
                ({{ getDaysRemaining(selectedVacancy) }} days remaining)
              </span>
            </div>
          </div>
          
          <div class="info-row" *ngIf="selectedVacancy.requirements">
            <div class="info-label">Requirements:</div>
            <div class="info-value">{{ selectedVacancy.requirements }}</div>
          </div>
          
          <div class="info-row" *ngIf="selectedVacancy.responsibilities">
            <div class="info-label">Responsibilities:</div>
            <div class="info-value">{{ selectedVacancy.responsibilities }}</div>
          </div>
        </div>
        
        <!-- Applications Section -->
        <div class="applications-section" *ngIf="applications && applications.length > 0">
          <h3>Applications ({{ applications.length }})</h3>
          <div class="applications-list">
            <div *ngFor="let application of applications" 
                 class="application-card" 
                 [routerLink]="['/application-details', application.id]" 
                 style="cursor:pointer">
              <div class="application-header">
                <div class="application-name">{{ application.fullName }}</div>
                <div class="application-date">{{ application.appliedDate | date:'mediumDate' }}</div>
              </div>
              <div class="application-meta">
                <span [ngClass]="getGenderText(application.gender)">
                  {{ getGenderText(application.gender) }}
                </span>
                <span>{{ application.yearsOfExperience || 0 }} years experience</span>
              </div>
              <div>
                <span [ngClass]="getApplicationStatusClass(application.status || 'new')">
                  {{ application.status || 'new' }}
                </span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- No Applications Message -->
        <div class="applications-section" *ngIf="!applications || applications.length === 0">
          <div class="no-applications">
            <i class="fas fa-inbox"></i>
            <p>No applications yet for this vacancy</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Placeholder when no vacancy selected -->
    <div class="vacancy-details" *ngIf="!selectedVacancy && filteredVacancies.length > 0">
      <div class="details-placeholder">
        <i class="fas fa-briefcase"></i>
        <h3>Select a Vacancy</h3>
        <p>Click on a vacancy from the list to view details</p>
      </div>
    </div>
    
    <!-- No vacancies message -->
    <div *ngIf="filteredVacancies.length === 0 && !isLoading" class="no-vacancies">
      <i class="fas fa-briefcase"></i>
      <h3>No Vacancies Found</h3>
      <p>Try adjusting your filters or add a new vacancy</p>
      <button class="btn-add" (click)="addNewVacancy()">
        <i class="fas fa-plus"></i> Add Your First Vacancy
      </button>
    </div>
  </div>

  <!-- Modal for Add/Edit Vacancy -->
  <div *ngIf="showVacancyModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Edit Vacancy' : 'Add New Vacancy' }}</h2>
        <button class="close-btn" (click)="closeModal()">âœ•</button>
      </div>

      <form [formGroup]="vacancyForm" class="vacancy-form">
        <div class="form-group">
          <label>Title *</label>
          <input 
            type="text" 
            formControlName="title" 
            class="form-input"
            [class.error]="title?.invalid && title?.touched"
          />
          <span class="error-message" *ngIf="title?.invalid && title?.touched">
            Title is required
          </span>
        </div>

        <div class="form-group">
          <label>Description *</label>
          <textarea 
            formControlName="description" 
            class="form-textarea"
            [class.error]="description?.invalid && description?.touched"
            rows="4"
          ></textarea>
          <span class="error-message" *ngIf="description?.invalid && description?.touched">
            Description is required
          </span>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Employment Type *</label>
            <select 
              formControlName="employmentType" 
              class="form-select"
              [class.error]="employmentType?.invalid && employmentType?.touched"
            >
              <option value="Full-time">Full-time</option>
              <option value="Part-time">Part-time</option>
              <option value="Contract">Contract</option>
              <option value="Internship">Internship</option>
            </select>
          </div>

          <div class="form-group">
            <label>Status *</label>
            <select 
              formControlName="status" 
              class="form-select"
              [class.error]="status?.invalid && status?.touched"
            >
              <option value="Open">Open</option>
              <option value="Closed">Closed</option>
              <option value="Draft">Draft</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Number of Openings *</label>
            <input 
              type="number" 
              formControlName="numberOfOpenings" 
              class="form-input"
              min="1"
              [class.error]="numberOfOpenings?.invalid && numberOfOpenings?.touched"
            />
          </div>

          <div class="form-group">
            <label>Location</label>
            <input 
              type="text" 
              formControlName="location" 
              class="form-input"
              placeholder="e.g., Cairo, Egypt"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Min Salary</label>
            <input 
              type="number" 
              formControlName="minSalary" 
              class="form-input"
              placeholder="Minimum salary"
            />
          </div>

          <div class="form-group">
            <label>Max Salary</label>
            <input 
              type="number" 
              formControlName="maxSalary" 
              class="form-input"
              placeholder="Maximum salary"
            />
          </div>
        </div>

        <div class="form-group">
          <label>
            <input 
              type="checkbox" 
              formControlName="isRemote" 
              class="form-checkbox"
            />
            Remote Position
          </label>
        </div>

        <div class="modal-actions">
          <button 
            type="button" 
            class="btn-cancel" 
            (click)="closeModal()"
            [disabled]="isSaving"
          >
            Cancel
          </button>
          <button 
            type="button" 
            class="btn-save" 
            (click)="saveVacancy()"
            [disabled]="isSaving"
          >
            {{ isSaving ? 'Saving...' : (isEditMode ? 'Update' : 'Create') }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteConfirm" class="modal-overlay" (click)="cancelDelete()">
    <div class="confirm-modal" (click)="$event.stopPropagation()">
      <div class="confirm-header">
        <i class="fas fa-exclamation-triangle"></i>
        <h2>Delete Vacancy</h2>
      </div>
      
      <div class="confirm-body">
        <p>Are you sure you want to delete this vacancy?</p>
        <p class="vacancy-title">{{ selectedVacancy?.title }}</p>
        <p class="warning-text">This action cannot be undone.</p>
      </div>
      
      <div class="confirm-actions">
        <button 
          class="btn-cancel" 
          (click)="cancelDelete()"
          [disabled]="isLoading"
        >
          Cancel
        </button>
        <button 
          class="btn-confirm-delete" 
          (click)="deleteVacancy()"
          [disabled]="isLoading"
        >
          {{ isLoading ? 'Deleting...' : 'Delete' }}
        </button>
      </div>
    </div>
  </div>
</div>